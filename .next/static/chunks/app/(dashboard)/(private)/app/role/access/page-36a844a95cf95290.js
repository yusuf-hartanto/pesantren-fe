(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9699],{53057:(e,a,t)=>{Promise.resolve().then(t.bind(t,31716))},50686:(e,a,t)=>{"use strict";t.d(a,{a:()=>l});var r=t(12115);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,[a,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let a=window.matchMedia("(max-width: ".concat(e,"px)")),r=()=>t(a.matches);return r(),a.addEventListener("change",r),()=>a.removeEventListener("change",r)},[e]),a}},27944:(e,a,t)=>{"use strict";t.d(a,{Uv:()=>r,Yw:()=>l,qB:()=>d});let r=e=>{let a=new Map;e.forEach(e=>{a.set(e.menu_id,{...e,children:[]})});let t=[];a.forEach(e=>{if("00000000-0000-0000-0000-000000000000"===e.parent_id)t.push(e);else{let t=a.get(e.parent_id);t&&t.children.push(e)}});let r=e=>{e.sort((e,a)=>e.seq_number-a.seq_number),e.forEach(e=>e.children&&r(e.children))};return r(t),t},l=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=[];return e.forEach(e=>{var r;t.push({...e,__level:a}),(null===(r=e.children)||void 0===r?void 0:r.length)&&(t=t.concat(l(e.children,a+1)))}),t},d=e=>{var a;let t=e.children&&e.children.length>0;return{id:e.menu_id,label:e.menu_name,icon:null!==(a=e.menu_icon)&&void 0!==a?a:"tabler-circle",..."#"===e.module_name||t?{}:{href:e.module_name},...t?{children:e.children.map(e=>d(e))}:{}}}},33176:(e,a,t)=>{"use strict";t.d(a,{$u:()=>i,Ay:()=>p,EG:()=>m,RW:()=>u,dp:()=>n,fd:()=>c,oV:()=>o,uK:()=>s});var r=t(48943),l=t(83197);let d={dataPage:{values:[],total:0},data:{},datas:[],crud:null,delete:null},n=(0,r.zD)("menu/fetchAll",async(e,a)=>{try{return(await l.A.get("/app/menu/all-data",{params:e})).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),i=(0,r.zD)("menu/fetchPage",async(e,a)=>{try{return(await l.A.get("/app/menu",{params:e})).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),s=(0,r.zD)("menu/fetchById",async(e,a)=>{try{return(await l.A.get("/app/menu/".concat(e))).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),o=(0,r.zD)("menu/create",async(e,a)=>{try{return(await l.A.post("/app/menu",e)).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),u=(0,r.zD)("menu/update",async(e,a)=>{let{id:t,params:r}=e;try{return(await l.A.put("/app/menu/".concat(t),r)).data}catch(e){var d;return a.fulfillWithValue(null===(d=e.response)||void 0===d?void 0:d.data)}}),c=(0,r.zD)("menu/delete",async(e,a)=>{try{return(await l.A.delete("/app/menu/".concat(e))).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),h=(0,r.Z0)({name:"menu",initialState:d,reducers:{resetRedux:()=>d},extraReducers:e=>{e.addCase(n.fulfilled,(e,a)=>{e.datas=a.payload.data||[]}),e.addCase(i.fulfilled,(e,a)=>{var t,r;e.dataPage={values:(null===(t=a.payload.data)||void 0===t?void 0:t.values)||[],total:(null===(r=a.payload.data)||void 0===r?void 0:r.total)||0}}),e.addCase(s.fulfilled,(e,a)=>{e.data=a.payload.data}),e.addCase(c.fulfilled,(e,a)=>{e.delete=a.payload.message}),e.addCase(o.fulfilled,(e,a)=>{e.crud=a.payload}),e.addCase(u.fulfilled,(e,a)=>{e.crud=a.payload})}}),{resetRedux:m}=h.actions,p=h.reducer},31716:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>w});var r=t(95155),l=t(12115),d=t(76046),n=t(64665),i=t(63551),s=t(42479),o=t(69606),u=t(91068),c=t(2615),h=t(81638),m=t(13375),p=t(96063),v=t(33176),f=t(27944),y=t(56564),g=t(50686);let _=["view","create","edit","delete","import","export"],x={role_id:"",role_name:"",menu:[]},w=()=>{let e=(0,d.useRouter)(),{update:a}=(0,c.useSession)(),t=(0,l.useRef)({role_id:{value:"",label:""},menu:[]}),w=(0,d.useSearchParams)().get("id"),j=(0,h.j)(),b=(0,h.G)(e=>e.role),A=(0,h.G)(e=>e.role.navigation),N=(0,g.a)(1e3),[E,z]=(0,l.useState)(x),[C,k]=(0,l.useState)(!1),[L,W]=(0,l.useState)([]),{control:V,handleSubmit:D,formState:{errors:R},reset:P}=(0,o.mN)({defaultValues:x}),S=(0,l.useMemo)(()=>{let e={};return E.menu.forEach(a=>{e[a.menu_id]=a}),e},[E.menu]),q=(0,l.useMemo)(()=>Array.isArray(L)?L:[],[L]),M=e=>{let a=[],t=e=>{e.forEach(e=>{a.push({menu_id:e.menu_id,module_name:e.module_name,view:0,create:0,edit:0,delete:0,import:0,export:0,status:1}),Array.isArray(e.children)&&t(e.children)})};return t(e),a};(0,l.useEffect)(()=>{j((0,v.dp)({})).then(e=>{var a;let t=null==e?void 0:null===(a=e.payload)||void 0===a?void 0:a.data;if(!Array.isArray(t))return;let r=(0,f.Uv)(t);j((0,m.dI)(r))}),w&&j((0,m.qi)(w)).then(e=>{var a,t;let r=null==e?void 0:null===(a=e.payload)||void 0===a?void 0:a.data;r&&(z(e=>({...e,role_id:r.role_id,role_name:r.role_name})),P({role_id:r.role_id,role_name:r.role_name}),W(null!==(t=r.menu)&&void 0!==t?t:[]))})},[j,w,P]);let B=(0,l.useCallback)(()=>{j((0,m.EG)()),e.replace("/app/role/list")},[j,e]);(0,l.useEffect)(()=>{if(b.crud){if(b.crud.status){var e;u.oR.success("Success saved");let r=null===(e=t.current)||void 0===e?void 0:e.menu.reduce((e,a)=>(e[(0,y._Y)(a.module_name)]={view:1===a.view,create:1===a.create,edit:1===a.edit,delete:1===a.delete,import:1===a.import,export:1===a.export},e),{}),l=Object.values(r).some(e=>!1===e.view);a({permissions:r}),l&&window.location.reload(),B()}else u.oR.error("Error saved: "+b.crud.message),k(!1)}},[B,b,a]);let O=(e,a)=>{let t=new Map(a.map(e=>[e.menu_id,e]));return e.map(e=>t.has(e.menu_id)?{...e,...t.get(e.menu_id)}:e)};(0,l.useEffect)(()=>{if(!A.length)return;let e=O(M(A),q);z(a=>({...a,menu:e}))},[A,q]);let G=(e,a,t)=>{var r,l;return(null===(r=e.children)||void 0===r?void 0:r.length)?e.children.some(e=>G(e,a,t)):(null===(l=t[e.menu_id])||void 0===l?void 0:l[a])===1},I=e=>E.menu.length>0&&E.menu.every(a=>1===a[e]),Z=e=>E.menu.some(a=>1===a[e])&&!I(e),Y=(e,a)=>{z(t=>({...t,menu:t.menu.map(t=>({...t,[e]:a?1:0}))}))},$=e=>{var a;return{...e,create:0,edit:0,delete:0,import:0,export:0,children:null===(a=e.children)||void 0===a?void 0:a.map($)}},T=(e,a,t)=>{z(r=>({...r,menu:r.menu.map(r=>r.menu_id!==e?r:"view"!==a||t?"view"!==a&&t?{...r,view:1,[a]:1}:{...r,[a]:t?1:0}:{...$(r),view:0})}))},U=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>(0,r.jsxs)(l.Fragment,{children:[(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",style:{paddingLeft:20*a},children:[e.menu_icon&&(0,r.jsx)("i",{className:e.menu_icon}),(0,r.jsx)("span",{className:0===a?"font-semibold":"",children:e.menu_name})]})}),_.map(a=>{var t,l;return(0,r.jsx)("td",{className:"px-3 py-2 text-center",children:(0,r.jsx)("input",{type:"checkbox",className:"w-4 h-4",checked:(null===(t=S[e.menu_id])||void 0===t?void 0:t[a])===1||G(e,a,S),disabled:"view"!==a&&(null===(l=S[e.menu_id])||void 0===l?void 0:l.view)===0,onChange:t=>T(e.menu_id,a,t.target.checked)})},a)})]}),Array.isArray(e.children)&&U(e.children,a+1)]},e.menu_id))},F=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-3 bg-white shadow-sm",style:{marginLeft:12*a},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.menu_icon&&(0,r.jsx)("i",{className:e.menu_icon}),(0,r.jsx)("span",{className:0===a?"font-semibold":"font-medium",children:e.menu_name})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:_.map(a=>{var t,l;let d=(null===(t=S[e.menu_id])||void 0===t?void 0:t[a])===1||G(e,a,S),n="view"!==a&&(null===(l=S[e.menu_id])||void 0===l?void 0:l.view)===0;return(0,r.jsxs)("label",{className:"flex items-center justify-between text-xs border rounded px-2 py-1\n                ".concat(n?"opacity-50":""),children:[(0,r.jsx)("span",{className:"capitalize",children:a}),(0,r.jsx)("input",{type:"checkbox",className:"w-4 h-4",checked:d,disabled:n,onChange:t=>T(e.menu_id,a,t.target.checked)})]},a)})}),Array.isArray(e.children)&&e.children.length>0&&(0,r.jsx)("div",{className:"mt-3 space-y-2 border-l pl-3",children:F(e.children,a+1)})]},e.menu_id))};return(0,r.jsxs)(n.default,{children:[(0,r.jsx)(i.default,{title:"Form Role"}),(0,r.jsx)(s.default,{children:(0,r.jsx)("form",{onSubmit:D(()=>{if(C)return;k(!0);let e={role_id:{value:E.role_id,label:E.role_name},menu:E.menu.filter(e=>_.some(a=>1===e[a]))};t.current=e,j((0,m.qY)([e]))}),autoComplete:"off",children:(0,p.v$)({control:V,errors:R,state:E,setState:z,fields:[(0,p.ZZ)({type:"text",key:"role_name",label:"Role Name",placeholder:"Input role name",required:!0,readOnly:!0}),(0,p.ZZ)({type:"custom",key:"menu",render:()=>N?(0,r.jsx)("div",{className:"space-y-3",children:F(A)}):(0,r.jsxs)("table",{className:"table w-full border border-gray-200 text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"Menu"}),_.map(e=>(0,r.jsxs)("th",{className:"px-3 py-2 text-center",children:[(0,r.jsx)("div",{className:"capitalize",children:e}),(0,r.jsx)("input",{type:"checkbox",className:"w-4 h-4",checked:I(e),ref:a=>{a&&(a.indeterminate=Z(e))},onChange:a=>Y(e,a.target.checked)})]},e))]})}),(0,r.jsx)("tbody",{children:U(A)})]})}),(0,p.Jw)({onCancel:B,loading:C})]})})})]})}},13375:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>g,EG:()=>f,EO:()=>c,Wb:()=>u,d3:()=>s,dI:()=>y,e4:()=>i,qY:()=>m,qi:()=>h,tz:()=>o});var r=t(48943),l=t(83197);let d={dataPage:{values:[],total:0},data:{},datas:[],crud:null,delete:null,navigation:[]},n=(0,r.zD)("role/fetchAll",async(e,a)=>{try{return(await l.A.get("/app/role/all-data",{params:e})).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),i=(0,r.zD)("role/fetchPage",async(e,a)=>{try{return(await l.A.get("/app/role",{params:e})).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),s=(0,r.zD)("role/fetchById",async(e,a)=>{try{return(await l.A.get("/app/role/".concat(e))).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),o=(0,r.zD)("role/create",async(e,a)=>{try{return(await l.A.post("/app/role",e)).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),u=(0,r.zD)("role/update",async(e,a)=>{let{id:t,params:r}=e;try{return(await l.A.put("/app/role/".concat(t),r)).data}catch(e){var d;return a.fulfillWithValue(null===(d=e.response)||void 0===d?void 0:d.data)}}),c=(0,r.zD)("role/delete",async(e,a)=>{try{return(await l.A.delete("/app/role/".concat(e))).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),h=(0,r.zD)("role/fetchRoleMenuById",async(e,a)=>{try{return(await l.A.get("/app/role-menu/".concat(e))).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),m=(0,r.zD)("role/postRoleMenu",async(e,a)=>{try{return(await l.A.post("/app/role-menu",e)).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),p=(0,r.zD)("role/fetchNavigation",async(e,a)=>{try{return(await l.A.get("/navigation",{headers:{Authorization:void 0}})).data}catch(e){var t;return a.fulfillWithValue(null===(t=e.response)||void 0===t?void 0:t.data)}}),v=(0,r.Z0)({name:"role",initialState:d,reducers:{resetRedux:()=>d,setNavigation:(e,a)=>{e.navigation=a.payload}},extraReducers:e=>{e.addCase(n.fulfilled,(e,a)=>{e.datas=a.payload.data||[]}),e.addCase(i.fulfilled,(e,a)=>{var t,r;e.dataPage={values:(null===(t=a.payload.data)||void 0===t?void 0:t.values)||[],total:(null===(r=a.payload.data)||void 0===r?void 0:r.total)||0}}),e.addCase(s.fulfilled,(e,a)=>{e.data=a.payload.data}),e.addCase(c.fulfilled,(e,a)=>{e.delete=a.payload.message}),e.addCase(o.fulfilled,(e,a)=>{e.crud=a.payload}),e.addCase(u.fulfilled,(e,a)=>{e.crud=a.payload}),e.addCase(m.fulfilled,(e,a)=>{e.crud=a.payload}),e.addCase(p.fulfilled,(e,a)=>{e.navigation=a.payload.data||[]})}}),{resetRedux:f,setNavigation:y}=v.actions,g=v.reducer},83197:(e,a,t)=>{"use strict";t.d(a,{A:()=>u});var r=t(82651),l=t(2615),d=t(68411);let n=r.A.create({baseURL:"http://103.197.190.47:5001"}),i=!1,s=[];n.defaults.showLoading=!0;let o=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;s.forEach(t=>{e?t.reject(e):t.resolve(a)}),s=[]};n.interceptors.request.use(async e=>{var a;let t=await (0,l.getSession)();return(null==t?void 0:t.access_token)&&(e.headers.Authorization="Bearer ".concat(t.access_token)),(null!==(a=e.showLoading)&&void 0!==a?a:n.defaults.showLoading)&&(d.L.start(),d.L.progress(10)),e}),n.interceptors.response.use(e=>{var a;return(null!==(a=e.config.showLoading)&&void 0!==a?a:n.defaults.showLoading)&&(d.L.progress(100),setTimeout(()=>{d.L.stop(),d.L.progress(0)},300)),e},async e=>{var a,t;let r=e.config;if((null!==(t=r.showLoading)&&void 0!==t?t:n.defaults.showLoading)&&(d.L.stop(),d.L.progress(0)),(null===(a=e.response)||void 0===a?void 0:a.status)===401&&!r._retry){if(i)return new Promise((e,a)=>{s.push({resolve:e,reject:a})}).then(e=>(r.headers.Authorization="Bearer ".concat(e),n(r))).catch(e=>Promise.reject(e));r._retry=!0,i=!0;try{let a=await fetch("/api/auth/refresh",{method:"GET"}),t=await a.json();if((null==t?void 0:t.error)==="RefreshAccessTokenError")return(0,l.signOut)(),Promise.reject(e);let d=null==t?void 0:t.access_token;return o(null,d),i=!1,r.headers.Authorization="Bearer ".concat(d),n(r)}catch(e){return o(e,null),i=!1,(0,l.signOut)(),Promise.reject(e)}}return Promise.reject(e)});let u=n},68411:(e,a,t)=>{"use strict";t.d(a,{L:()=>n});let r=[],l=[],d=0,n={subscribe:e=>(r.push(e),()=>{r=r.filter(a=>a!==e)}),emit(e){r.forEach(a=>a(e))},start(){d++,this.emit(!0)},stop(){--d<=0&&(d=0,this.emit(!1))},onProgress:e=>(l.push(e),()=>{l=l.filter(a=>a!==e)}),progress(e){l.forEach(a=>a(e))}}},56564:(e,a,t)=>{"use strict";function r(e,a,t){if(!e)return!1;let r=e[l(a)];return!!r&&(Array.isArray(t)?t:[t]).every(e=>!0===r[e])}function l(e){return e.toLowerCase().split("?")[0].replace(/\/(list|form|edit|detail|access|import)(\/.*)?$/,"").replace(/\/$/,"")}t.d(a,{$3:()=>r,_Y:()=>l})}},e=>{var a=a=>e(e.s=a);e.O(0,[5099,275,5004,277,5876,777,5273,2295,9892,2806,2598,6874,6403,6298,5181,9905,3784,9234,9668,9639,545,2615,505,2651,1019,790,9606,1829,8235,7643,3126,8441,1517,7358],()=>a(53057)),_N_E=e.O()}]);